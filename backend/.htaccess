<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Разрешаем CORS
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Authorization, Content-Type, Accept"
    Header always set Access-Control-Allow-Credentials "true"
    
    # Обработка OPTIONS запросов
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=204,L]
    
    # API маршруты направляем на backend/api/index.php
    RewriteCond %{REQUEST_URI} ^/backend/api/
    RewriteRule ^backend/api/(.*)$ backend/api/index.php [L,QSA]
    
    # Flutter Web файлы - доставляем как есть
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^.*$ - [L]
    
    # Flutter Web - все остальные запросы на index.html
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/backend/
    RewriteRule ^.*$ /index.html [L]
</IfModule>

# Защита от листинга директорий
Options -Indexes

# PHP настройки (если поддерживается)
<IfModule mod_php.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>