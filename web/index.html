<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="SecureWave Secure Messenger">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="SecureWave">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png"/>
  <title>SecureWave</title>
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 9999;
    }
    
    #loading-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }
    
    #loading-title {
      font-size: 32px;
      font-weight: bold;
      color: white;
      margin-bottom: 40px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    #loading-text {
      margin-top: 20px;
      font-size: 16px;
      color: rgba(255, 255, 255, 0.7);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
  </style>
</head>
<body>
  <div id="loading">
    <div id="loading-icon">üîê</div>
    <div id="loading-title">SecureWave</div>
    <div class="spinner"></div>
    <div id="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <!-- –í–ê–ñ–ù–û: Firebase SDK –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –ü–ï–†–í–´–ú -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>

  <!-- Firebase Configuration -->
  <script>
    console.log('[HTML] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAW5HurHMo1l9ub2XKyr2nk-yP22bc_6F4",
      authDomain: "wave-messenger-56985.firebaseapp.com",
      projectId: "wave-messenger-56985",
      storageBucket: "wave-messenger-56985.firebasestorage.app",
      messagingSenderId: "394959992893",
      appId: "1:394959992893:web:c7d493658ad06278661254"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    try {
      if (typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        console.log('‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('‚úÖ Firebase config:', firebaseConfig);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ messaging –¥–æ—Å—Ç—É–ø–µ–Ω
        if (firebase.messaging.isSupported()) {
          console.log('‚úÖ Firebase Messaging –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        } else {
          console.warn('‚ö†Ô∏è Firebase Messaging –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
        }
      } else {
        console.error('‚ùå Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:', error);
    }
  </script>

  <!-- Flutter loader -->
  <script src="flutter.js" defer></script>
  <script>
    window.addEventListener('load', function(ev) {
      console.log('[HTML] Page loaded, starting Flutter...');
      
      var serviceWorkerVersion = null;
      
      if (typeof _flutter !== 'undefined') {
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: function(engineInitializer) {
            console.log('[HTML] Flutter entrypoint loaded');
            engineInitializer.initializeEngine().then(function(appRunner) {
              console.log('[HTML] Flutter engine initialized, running app...');
              appRunner.runApp();
              
              // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
              setTimeout(function() {
                const loading = document.getElementById('loading');
                if (loading) {
                  loading.style.opacity = '0';
                  loading.style.transition = 'opacity 0.3s';
                  setTimeout(function() {
                    loading.remove();
                  }, 300);
                }
              }, 1000);
            });
          }
        });
      }
    });
  </script>

  <!-- ========================================= -->
  <!-- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø FIREBASE SERVICE WORKER       -->
  <!-- ========================================= -->
  <script>
    console.log('[HTML] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker...');
    
    if ('serviceWorker' in navigator) {
      // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
          .then((registration) => {
            console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
            console.log('‚úÖ Registration:', registration);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Service Worker
            if (registration.active) {
              console.log('‚úÖ Service Worker –∞–∫—Ç–∏–≤–µ–Ω');
            } else if (registration.installing) {
              console.log('‚è≥ Service Worker —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...');
            } else if (registration.waiting) {
              console.log('‚è≥ Service Worker –æ–∂–∏–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏...');
            }
          })
          .catch((error) => {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
          });
        
        // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Service Worker
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('üîÑ Service Worker –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–∑–º–µ–Ω–∏–ª—Å—è');
        });
      });
    } else {
      console.warn('‚ö†Ô∏è Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
    }
  </script>

</body>
</html>